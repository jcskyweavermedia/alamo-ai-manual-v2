{
  "_comment": "Generic webhook configuration template for Apify Actor Tasks. Copy this template and customize the 'meta' block for each restaurant/platform combination. Configure this in: Apify Console > Actor Task > Integrations > Webhooks",

  "eventTypes": [
    "ACTOR.RUN.SUCCEEDED",
    "ACTOR.RUN.FAILED"
  ],

  "requestUrl": "https://nxeorbwqsovybfttemrw.supabase.co/functions/v1/ingest-reviews",

  "headers": {
    "X-Apify-Webhook-Secret": "<APIFY_WEBHOOK_SECRET>"
  },

  "_comment_payload": "The payloadTemplate below uses Apify's Mustache-style template variables. Double-brace expressions like {{resource.id}} are replaced by Apify at delivery time with actual run data. The 'meta' block is static and must be customized per task.",

  "payloadTemplate": {
    "event": "{{eventType}}",
    "runId": "{{resource.id}}",
    "datasetId": "{{resource.defaultDatasetId}}",
    "actorId": "{{eventData.actorId}}",
    "actorTaskId": "{{eventData.actorTaskId}}",
    "status": "{{resource.status}}",
    "computeUnits": "{{resource.stats.computeUnits}}",
    "finishedAt": "{{resource.finishedAt}}",
    "meta": {
      "restaurant_id": "<RESTAURANT_UUID>",
      "platform": "<PLATFORM>",
      "group_id": "<GROUP_ID>"
    }
  },

  "_comment_meta_fields": {
    "restaurant_id": "UUID from the tracked_restaurants table. See apify/tasks/ files for per-restaurant values.",
    "platform": "One of: google, opentable, tripadvisor. Must match the actor being used.",
    "group_id": "UUID from the groups table. Query: SELECT id FROM groups WHERE slug = 'alamo-prime';"
  },

  "_comment_event_types": {
    "ACTOR.RUN.SUCCEEDED": "Triggers review ingestion -- the edge function fetches the dataset and upserts reviews.",
    "ACTOR.RUN.FAILED": "Triggers failure logging -- the edge function records a failed scrape_run for audit."
  },

  "_restaurant_ids": {
    "Alamo Prime Steakhouse": "11111111-1111-1111-1111-111111111111",
    "Longhorn & Ember": "22222222-2222-2222-2222-222222222222",
    "Salt & Sear Chophouse": "33333333-3333-3333-3333-333333333333",
    "Mesquite Flame Grill": "44444444-4444-4444-4444-444444444444"
  },

  "_platforms": [
    "google",
    "opentable",
    "tripadvisor"
  ]
}
